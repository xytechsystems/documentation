
# Response payload parsing and storing of values
Response payload parsing and storing of values. [16326](https://dev.azure.com/xytsystems/Xytech%20Platform/_workitems/edit/16326)
## Summary
Web hooks includes the ability to store a value(s) received in the response body back into a field from the triggered document.

This allows Xytech to store the ID generated by an external system as a result of a web hook POST that creates the record.

## Details
Supports scalar and single values to be read and stored. Not arrays or JSON objects.
If you don’t specify a content type, the default will be plain text.
Mandatory for response to include content type header:
‘Content-Type’ of either 
•	application/json 
•	application/xml 
•	text/plain.
 Can only store values back into the originating document, not related documents.

## Setup Configuration
### Export Adaptor
The Export adaptor now includes ‘Response Format’ parameter to define the expected response format.

Includes Notes and Blob base64 image values.

	
Figure 1 - Response Format
 ![](assets/Pasted%20image%2020240612151054.png)

### Event Trigger
The Event Trigger includes a new field to define the Export Adaptor’s ‘Response Parsing Template’.
Here you will add the parse criteria in the format of ```<database field> = <parse field>```.

Figure 2 - Response Parsing Template
![](assets/Pasted%20image%2020240612151138.png)

### Parse JSON 
Example
Response payload:
```json
{
    "data": {
        "desc": "This is sample description.",
        "id": "ABCEFJ23454"
    }
}
```

To retrieve the ‘id’ value a response template would contain:
[table.column] = data.id

If the originating document was Title and you wanted to store the value into ‘external_key’, then the full example would look like this:
[lib_title.external_key] = data.id

You can store more than one value from the response payload: 
e.g.:
[table.field1] = data.id
[table.field2] = data.desc

### Parse XML 
To parse an XML response, use  XPATH syntax.
W3Schools XPath tutorial: https://www.w3schools.com/xml/xpath_intro.asp

Simple parse:
[lib_title.external_key] = response/desc

An attribute of an element:
[lib_title.external_key] = catalog/book/@id		

Return all values under /response
[lib_title.title_desc_2] = response


[lib_title. title_desc_2] = catalog/book[@id='bk102']/title

Example XML:
```xml
<?xml version="1.0"?>
<catalog>
     <book id="bk101">
        <author>Gambardella, Matthew</author>
        <title>XML Developer's Guide</title>
        <genre>Computer</genre>
        <price>44.95</price>
        <publish_date>2000-10-01</publish_date>
        <description>An in-depth look at creating applications 
        with XML.</description>
     </book>
     <book id="bk102">
        <author>Ralls, Kim</author>
        <title>Midnight Rain</title>
        <genre>Fantasy</genre>
        <price>5.95</price>
        <publish_date>2000-12-16</publish_date>
        <description>A former architect battles corporate zombies, 
        an evil sorceress, and her own childhood to become queen 
        of the world.</description>
     </book>
</catalog>
```
 
[lib_title.external_key] = catalog/book/@id		returns the first id
[lib_title.title_desc_2] = catalog/book[@id='bk102']/title	returns null
[lib_title.note_no_text] = catalog/book		returns all values from the first item only – expected both items.

### Parse Text


 # **v10.6 Known limitations**
- Export Adaptor - Unable to add a custom Header that is generated by default, such a Content-Header e.g. when trying to add a Header of application/json-patch+json
- Export Adaptor - unable to define a JSON template that opens with square brackets e.g. [] as used in a PATCH call to the Xytech REST API


# URL Parameters now use table names (not DOC prefix)

# Webhooks - Add GET as an Export Adaptor method
https://dev.azure.com/xytsystems/Xytech%20Platform/_workitems/edit/20482
